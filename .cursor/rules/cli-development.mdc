# CLI å¼€å‘æœ€ä½³å®è·µ

## é¡¹ç›®æ¶æ„

### å…¥å£ç‚¹è®¾è®¡
[src/cli.tsx](mdc:src/cli.tsx) ä½œä¸ºä¸»å…¥å£ï¼Œæ”¯æŒå‘½ä»¤è¡Œå‚æ•°å¤„ç†ï¼š

```typescript
#!/usr/bin/env node

import React from 'react';
import { render } from 'ink';
import { App } from './components/App.js';

// æ£€æŸ¥å‘½ä»¤è¡Œå‚æ•°
const args = process.argv.slice(2);

if (args.includes('--config') || args.includes('-c')) {
  // é…ç½®æ£€æŸ¥æ¨¡å¼
  showConfigStatus();
  process.exit(0);
}

if (args.includes('--help') || args.includes('-h')) {
  // æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  showHelp();
  process.exit(0);
}

// å¯åŠ¨ä¸»åº”ç”¨
render(<App />);
```

### å‘½ä»¤è¡Œå‚æ•°è§„èŒƒ
```bash
# åŸºæœ¬ä½¿ç”¨
npm run dev                 # å¯åŠ¨èŠå¤©ç•Œé¢

# è¯Šæ–­å‘½ä»¤
npm run dev -- --config    # æ£€æŸ¥é…ç½®çŠ¶æ€
npm run dev -- -c          # ç®€å†™å½¢å¼

# å¸®åŠ©ä¿¡æ¯
npm run dev -- --help      # æ˜¾ç¤ºå¸®åŠ©
npm run dev -- -h          # ç®€å†™å½¢å¼
```

## Ink æ¡†æ¶è§„èŒƒ

### åº”ç”¨å¸ƒå±€æ¨¡å¼
å‚è€ƒ [src/components/App.tsx](mdc:src/components/App.tsx) çš„4å±‚å¸ƒå±€ï¼š

```typescript
<Box flexDirection="column" height="100%" padding={1}>
  {/* 1. é¡¶éƒ¨æ ‡é¢˜ */}
  <Header />
  
  {/* 2. ä¸­é—´å†…å®¹åŒºåŸŸ */}
  <MessageHistory messages={appState.messages} />
  
  {/* 3. åº•éƒ¨è¾“å…¥æ¡† */}
  <InputBox onSubmit={handleSubmit} isLoading={appState.isLoading} />
  
  {/* 4. çŠ¶æ€æ  */}
  <StatusBar statusMessage={appState.statusMessage} error={appState.error} />
</Box>
```

### ç»„ä»¶è®¾è®¡åŸåˆ™

#### å•ä¸€èŒè´£
æ¯ä¸ªç»„ä»¶ä¸“æ³¨ä¸€ä¸ªåŠŸèƒ½ï¼š
- `Header`: æ˜¾ç¤ºåº”ç”¨æ ‡é¢˜å’Œç‰ˆæœ¬
- `MessageHistory`: æ¶ˆæ¯å†å²ç®¡ç†å’Œæ˜¾ç¤º
- `InputBox`: ç”¨æˆ·è¾“å…¥å¤„ç†
- `StatusBar`: çŠ¶æ€ä¿¡æ¯æ˜¾ç¤º

#### å±æ€§æ¥å£
```typescript
// è¾“å…¥ç»„ä»¶
export interface InputBoxProps {
  onSubmit: (message: string) => void;
  isLoading: boolean;
}

// çŠ¶æ€æ ç»„ä»¶
export interface StatusBarProps {
  statusMessage: string;
  error?: string;
}
```

## ç”¨æˆ·äº¤äº’æ¨¡å¼

### é”®ç›˜è¾“å…¥å¤„ç†
å‚è€ƒ [src/components/InputBox.tsx](mdc:src/components/InputBox.tsx)ï¼š

```typescript
import { useInput } from 'ink';

export const InputBox: React.FC<InputBoxProps> = ({ onSubmit, isLoading }) => {
  const [input, setInput] = useState('');

  useInput((inputText, key) => {
    if (isLoading) return; // åŠ è½½æ—¶ç¦ç”¨è¾“å…¥

    if (key.return) {
      // å›è½¦æäº¤
      if (input.trim()) {
        onSubmit(input.trim());
        setInput('');
      }
    } else if (key.backspace) {
      // é€€æ ¼åˆ é™¤
      setInput(prev => prev.slice(0, -1));
    } else if (!key.ctrl && !key.meta) {
      // æ™®é€šå­—ç¬¦è¾“å…¥
      setInput(prev => prev + inputText);
    }
  });

  return (
    <Box borderStyle="round" padding={1}>
      <Text>
        {'> '}{input}
        {isLoading ? ' (æ­£åœ¨å¤„ç†...)' : '_'}
      </Text>
    </Box>
  );
};
```

### çŠ¶æ€åé¦ˆ
```typescript
// åŠ è½½çŠ¶æ€
<Text color="yellow">æ­£åœ¨ä¸AIå¯¹è¯...</Text>

// æˆåŠŸçŠ¶æ€
<Text color="green">âœ… é…ç½®æ­£å¸¸ï¼Œæ‚¨å¯ä»¥å¼€å§‹èŠå¤©äº†ï¼</Text>

// é”™è¯¯çŠ¶æ€
<Text color="red">âŒ {error}</Text>

// è¾…åŠ©ä¿¡æ¯
<Text dimColor>å¼€å§‹æ‚¨çš„ç¬¬ä¸€æ¬¡å¯¹è¯...</Text>
```

## æ¶ˆæ¯æ˜¾ç¤ºè§„èŒƒ

### æ¶ˆæ¯æ ¼å¼
å‚è€ƒ [src/components/MessageHistory.tsx](mdc:src/components/MessageHistory.tsx)ï¼š

```typescript
const MessageItem: React.FC<{ message: Message }> = ({ message }) => {
  const icon = message.type === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–';
  const timeStr = message.timestamp.toLocaleTimeString();

  return (
    <Box flexDirection="column" marginBottom={1}>
      <Box>
        <Text color="cyan">{icon} {message.content}</Text>
      </Box>
      <Box marginLeft={3}>
        <Text dimColor>{timeStr}</Text>
      </Box>
    </Box>
  );
};
```

### æ»šåŠ¨å¤„ç†
```typescript
// è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
useEffect(() => {
  if (messages.length > 0) {
    // Ink è‡ªåŠ¨å¤„ç†æ»šåŠ¨ï¼Œæ— éœ€æ‰‹åŠ¨å®ç°
  }
}, [messages]);
```

## é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

### åˆ†å±‚é”™è¯¯å¤„ç†
```typescript
// 1. é…ç½®å±‚é”™è¯¯
if (!configValid) {
  return (
    <Box padding={1} borderStyle="round" borderColor="yellow">
      <Text color="yellow" bold>âš ï¸ é…ç½®æŒ‡å—</Text>
      <Text>è¯·ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½®æ‚¨çš„APIå¯†é’¥</Text>
    </Box>
  );
}

// 2. ç½‘ç»œå±‚é”™è¯¯
catch (error) {
  setAppState(prev => ({
    ...prev,
    error: error instanceof Error ? error.message : 'ç½‘ç»œè¿æ¥å¤±è´¥'
  }));
}

// 3. ä¸šåŠ¡å±‚é”™è¯¯
if (result.type === 'error') {
  throw new Error(result.data.error);
}
```

### ç”¨æˆ·å‹å¥½æç¤º
```typescript
// é…ç½®æŒ‡å—
<Text>è¯·ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå°† OPENAI_API_KEY è®¾ç½®ä¸ºæ‚¨çš„çœŸå®APIå¯†é’¥</Text>

// æ“ä½œæç¤º
<Text dimColor>æŒ‰å›è½¦å‘é€æ¶ˆæ¯ï¼ŒCtrl+C é€€å‡º</Text>

// é”™è¯¯æ¢å¤å»ºè®®
<Text>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•</Text>
```

## æ€§èƒ½ä¼˜åŒ–

### ç»„ä»¶ä¼˜åŒ–
```typescript
// ä½¿ç”¨ memo ä¼˜åŒ–æ¶ˆæ¯é¡¹æ¸²æŸ“
export const MessageItem = React.memo<MessageItemProps>(({ message }) => {
  // ç»„ä»¶å®ç°
});

// ä½¿ç”¨ useCallback ä¼˜åŒ–äº‹ä»¶å¤„ç†
const handleSubmit = useCallback((message: string) => {
  // å¤„ç†é€»è¾‘
}, []);
```

### çŠ¶æ€ä¼˜åŒ–
```typescript
// é›†ä¸­çŠ¶æ€ç®¡ç†
const [appState, setAppState] = useState<AppState>({
  messages: [],
  currentInput: '',
  isLoading: false,
  statusMessage: '',
  error: undefined
});

// æ‰¹é‡çŠ¶æ€æ›´æ–°
const updateState = (updates: Partial<AppState>) => {
  setAppState(prev => ({ ...prev, ...updates }));
};
```

## é…ç½®å’Œè¯Šæ–­

### é…ç½®æ£€æŸ¥å‘½ä»¤
```typescript
// é…ç½®çŠ¶æ€æ˜¾ç¤º
console.log('ğŸ”§ Translator Agent - é…ç½®çŠ¶æ€æ£€æŸ¥\n');
console.log(getConfigStatus());

// ç½‘ç»œè¿æ¥æµ‹è¯•
const networkStatus = await getNetworkStatus();
console.log(networkStatus);
```

### å¸®åŠ©ç³»ç»Ÿ
```typescript
const helpText = `
ğŸŒ Translator Agent - æ™ºèƒ½AIç¿»è¯‘åŠ©æ‰‹

ç”¨æ³•:
  npm run dev                 å¯åŠ¨èŠå¤©ç•Œé¢
  npm run dev -- --config    æ£€æŸ¥é…ç½®çŠ¶æ€
  npm run dev -- --help      æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

é…ç½®:
  ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½®æ‚¨çš„APIå¯†é’¥
  å‚è€ƒ .env.example æ–‡ä»¶è·å–é…ç½®è¯´æ˜
`;
```

## éƒ¨ç½²å’Œæ‰“åŒ…

### æ„å»ºé…ç½®
```json
{
  "scripts": {
    "dev": "tsx src/cli.tsx",
    "build": "tsc",
    "start": "node dist/cli.js"
  }
}
```

### å¯æ‰§è¡Œæ–‡ä»¶
```typescript
#!/usr/bin/env node
// ç¡®ä¿æ–‡ä»¶é¡¶éƒ¨æœ‰ shebang è¡Œ
```

### ç‰ˆæœ¬ç®¡ç†
```typescript
// åœ¨ Header ç»„ä»¶ä¸­æ˜¾ç¤ºç‰ˆæœ¬
<Text color="cyan" bold>Translator Agent v{version}</Text>

// ä» package.json è¯»å–ç‰ˆæœ¬
import { version } from '../../package.json';
```
